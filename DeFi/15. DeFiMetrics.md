# DeFi Metrics and Analytics

## Overview

Understanding DeFi metrics is essential for evaluating protocols, making investment decisions, and assessing ecosystem health.

## Protocol Metrics

### 1. Total Value Locked (TVL)

**Definition:** Total value of assets deposited in a protocol.

**Calculation:**
```
TVL = Σ(Token Amount × Token Price)

Example:
Protocol holds:
- 10,000 ETH @ $2,000 = $20M
- 5M USDC @ $1 = $5M
- 100 WBTC @ $40,000 = $4M

TVL = $20M + $5M + $4M = $29M
```

**Significance:**
- Measure of protocol adoption
- Proxy for liquidity
- Security indicator (more TVL = more at stake)
- Not always correlated with revenue

**Limitations:**
- Can be inflated (recursive deposits)
- Doesn't account for token price
- Doesn't show actual usage
- Can be manipulated


**TVL by Protocol (2024):**
```
1. Lido: $25B
2. Aave: $10B
3. MakerDAO: $8B
4. Curve: $5B
5. Uniswap: $4B
6. Compound: $3B
7. Convex: $2.5B
8. Rocket Pool: $2B
9. Balancer: $1.5B
10. GMX: $500M
```

**TVL by Chain:**
```
1. Ethereum: $50B (60%)
2. Tron: $8B (10%)
3. BSC: $5B (6%)
4. Arbitrum: $3B (4%)
5. Polygon: $2B (2%)
6. Avalanche: $1.5B (2%)
7. Optimism: $1B (1%)
8. Others: $12.5B (15%)

Total: ~$83B
```

**Manipulation Concerns:**
```
- Recursive deposits (deposit → borrow → deposit)
- Cross-protocol counting
- Inflated by incentives
- Doesn't reflect actual usage
```

### 2. Trading Volume

**Definition:** Total value of trades executed.

**Calculation:**
```
Daily Volume = Σ(Trade Amount × Token Price)

Example DEX:
- 1000 ETH traded @ $2,000 = $2M
- 500,000 USDC traded = $500K
- Total: $2.5M daily volume
```

**Volume by DEX (Daily):**
```
1. Uniswap: $1.5B
2. Curve: $500M
3. PancakeSwap: $400M
4. Balancer: $200M
5. SushiSwap: $150M
```

**Volume/TVL Ratio:**
```
Efficiency metric

High Ratio (>1.0):
- Capital efficient
- Active trading
- Good liquidity

Low Ratio (<0.1):
- Capital inefficient
- Idle liquidity
- Poor utilization

Example:
Uniswap: $1.5B volume / $4B TVL = 0.375 (37.5% daily)
Curve: $500M volume / $5B TVL = 0.10 (10% daily)
```

### 3. Revenue and Fees

**Protocol Revenue:**
```
Revenue = Fees Collected - Incentives Paid

Example:
Fees: $100M/year
Token Incentives: $80M/year
Net Revenue: $20M/year
```

**Fee Distribution:**
```
Uniswap V3:
- 100% to LPs
- 0% to protocol (fee switch off)

Curve:
- 50% to LPs
- 50% to veCRV holders

GMX:
- 70% to GLP holders
- 30% to GMX stakers
```

**Revenue by Protocol (Annual):**
```
1. Uniswap: $500M
2. Lido: $300M
3. Aave: $200M
4. MakerDAO: $150M
5. Curve: $100M
```

**P/F Ratio (Price-to-Fees):**
```
Similar to P/E ratio in stocks

P/F = Market Cap / Annual Fees

Example:
UNI Market Cap: $5B
Annual Fees: $500M
P/F Ratio: 10

Lower is better (cheaper valuation)
```

### 4. Active Users

**Definition:** Unique addresses interacting with protocol.

**Metrics:**
```
Daily Active Users (DAU)
Weekly Active Users (WAU)
Monthly Active Users (MAU)

Stickiness = DAU / MAU
Higher is better (more engaged users)
```

**Users by Protocol (Daily):**
```
1. Uniswap: 100K
2. Aave: 50K
3. Curve: 30K
4. Compound: 20K
5. MakerDAO: 10K
```

**User Growth Rate:**
```
Growth = (Current Users - Previous Users) / Previous Users × 100%

Example:
January: 50K users
February: 60K users
Growth: (60K - 50K) / 50K = 20%
```

**Cohort Analysis:**
```
Track user retention over time

Month 0: 1000 new users
Month 1: 300 still active (30% retention)
Month 2: 150 still active (15% retention)
Month 3: 100 still active (10% retention)
```

### 5. Token Metrics

**Market Capitalization:**
```
Market Cap = Circulating Supply × Price

Example:
UNI: 750M tokens × $6 = $4.5B
```

**Fully Diluted Valuation (FDV):**
```
FDV = Total Supply × Price

Example:
UNI Total Supply: 1B tokens
Price: $6
FDV: $6B

FDV/Market Cap Ratio: 6B / 4.5B = 1.33
```

**Token Velocity:**
```
Velocity = Transaction Volume / Market Cap

High Velocity:
- Tokens change hands frequently
- Less holding demand
- Bearish signal

Low Velocity:
- Tokens held long-term
- Strong holding demand
- Bullish signal
```

**Token Distribution:**
```
Healthy Distribution:
- Team: 15-25%
- Investors: 15-25%
- Community: 50-70%
- Treasury: 10-20%

Red Flags:
- Team > 40%
- Single holder > 20%
- Top 10 holders > 70%
```

## Lending Protocol Metrics

### 1. Utilization Rate

**Definition:** Percentage of supplied assets that are borrowed.

**Formula:**
```
Utilization = Total Borrowed / Total Supplied × 100%

Example:
Supplied: 1000 ETH
Borrowed: 600 ETH
Utilization: 60%
```

**Optimal Utilization:**
```
Too Low (< 40%):
- Idle capital
- Low yields for suppliers
- Inefficient

Optimal (60-80%):
- Good balance
- Healthy yields
- Available liquidity

Too High (> 90%):
- Liquidity crunch
- Withdrawal issues
- High borrow rates
```

### 2. Borrow/Supply APY Spread

**Definition:** Difference between borrow and supply rates.

**Calculation:**
```
Spread = Borrow APY - Supply APY

Example:
Borrow APY: 8%
Supply APY: 5%
Spread: 3%

Spread goes to:
- Protocol reserves
- Insurance fund
- Token buybacks
```

**Healthy Spread:**
```
2-5%: Sustainable
< 2%: Tight margins
> 5%: High protocol take rate
```

### 3. Liquidation Metrics

**Liquidation Volume:**
```
Total value liquidated over time

High liquidations indicate:
- Market volatility
- Overleveraged positions
- Liquidation cascades
```

**Liquidation Efficiency:**
```
Efficiency = Liquidations Completed / Liquidations Triggered

100%: All liquidations successful
< 100%: Some failed (bad debt created)

Example (MakerDAO Black Thursday):
- Efficiency: ~80%
- $8M bad debt created
- Gas prices too high for liquidators
```

**Bad Debt:**
```
Debt that cannot be recovered

Causes:
- Failed liquidations
- Oracle failures
- Extreme volatility
- Network congestion

Example:
Collateral: $100K
Debt: $95K
Liquidation fails
Collateral drops to $80K
Bad Debt: $15K
```

## DEX Metrics

### 1. Liquidity Depth

**Definition:** Available liquidity at different price levels.

**Measurement:**
```
Depth = Liquidity within X% of current price

Example:
ETH/USDC pool
Current price: $2,000

1% depth: $10M (liquidity between $1,980-$2,020)
2% depth: $18M (liquidity between $1,960-$2,040)
5% depth: $40M (liquidity between $1,900-$2,100)
```

**Importance:**
```
Deep liquidity:
- Low slippage
- Large trades possible
- Price stability

Shallow liquidity:
- High slippage
- Price manipulation risk
- Poor UX
```

### 2. Slippage

**Definition:** Difference between expected and executed price.

**Calculation:**
```
Slippage = (Executed Price - Expected Price) / Expected Price × 100%

Example:
Expected: $2,000 per ETH
Executed: $2,010 per ETH
Slippage: 0.5%
```

**Slippage by Trade Size:**
```
$1K trade: 0.01% slippage
$10K trade: 0.05% slippage
$100K trade: 0.2% slippage
$1M trade: 1% slippage
$10M trade: 5%+ slippage
```

### 3. Impermanent Loss

**Tracking IL:**
```
IL = (Current LP Value / Hold Value) - 1

Example:
Initial: $10,000
Hold Value: $12,000
LP Value: $11,400
IL: -5%
```

**IL vs Fees:**
```
Net Return = Fees Earned - Impermanent Loss

Example:
Fees: $500 (5%)
IL: -$300 (-3%)
Net: $200 (2%)

Profitable if fees > IL
```

### 4. LP Profitability

**ROI Calculation:**
```
ROI = (Fees + Rewards - IL - Gas) / Initial Investment × 100%

Example:
Initial: $10,000
Fees: $500
Rewards: $300
IL: -$200
Gas: -$50
Net: $550
ROI: 5.5%
```

**Annualized:**
```
APY = (1 + ROI)^(365/days) - 1

Example:
30-day ROI: 5.5%
APY: (1.055)^(365/30) - 1 = 82%
```

## Stablecoin Metrics

### 1. Peg Stability

**Deviation from Peg:**
```
Deviation = |Current Price - Target Price| / Target Price × 100%

Example:
Target: $1.00
Current: $0.998
Deviation: 0.2%

Healthy: < 0.5%
Concerning: 0.5-1%
Crisis: > 1%
```

**Peg History:**
```
Track price over time
Identify depeg events
Measure recovery time
```

### 2. Collateralization Ratio

**For Crypto-Backed Stablecoins:**
```
CR = Total Collateral Value / Total Stablecoin Supply × 100%

Example (DAI):
Collateral: $6B
DAI Supply: $5B
CR: 120%

Healthy: > 150%
Risky: 100-150%
Undercollateralized: < 100%
```

### 3. Redemption Rate

**Definition:** Percentage of redemptions that succeed.

**Calculation:**
```
Redemption Rate = Successful Redemptions / Total Redemption Attempts × 100%

100%: All redemptions work
< 100%: Some failures (liquidity issues)
```

### 4. Supply Growth

**Growth Rate:**
```
Growth = (Current Supply - Previous Supply) / Previous Supply × 100%

Example:
January: 5B USDC
February: 5.5B USDC
Growth: 10%

Positive: Increasing demand
Negative: Decreasing demand
```

## Yield Metrics

### 1. Real Yield

**Definition:** Yield from actual revenue, not token emissions.

**Calculation:**
```
Real Yield = Protocol Revenue / TVL × 100%

Example:
GMX:
Revenue: $50M/year
TVL: $500M
Real Yield: 10% APY

Sustainable long-term
```

**vs Nominal Yield:**
```
Nominal Yield = Real Yield + Token Emissions

Example:
Real Yield: 5%
Token Emissions: 15%
Nominal Yield: 20%

Token emissions are dilutive
Not sustainable long-term
```

### 2. Yield Sustainability

**Token Inflation Rate:**
```
Inflation = New Tokens Issued / Total Supply × 100%

Example:
Total Supply: 100M
Annual Issuance: 20M
Inflation: 20%

If yield is 30% but inflation is 20%:
Real yield: 10%
```

**Revenue Coverage:**
```
Coverage = Protocol Revenue / Token Emissions

> 1.0: Revenue covers emissions (sustainable)
< 1.0: Emissions exceed revenue (unsustainable)

Example:
Revenue: $10M
Emissions: $20M
Coverage: 0.5 (unsustainable)
```

### 3. Risk-Adjusted Returns

**Sharpe Ratio:**
```
Sharpe = (Return - Risk-Free Rate) / Volatility

Example:
Return: 20%
Risk-Free Rate: 4%
Volatility: 30%
Sharpe: (20% - 4%) / 30% = 0.53

Higher is better
> 1.0 is good
> 2.0 is excellent
```

**Sortino Ratio:**
```
Like Sharpe but only considers downside volatility

Sortino = (Return - Risk-Free Rate) / Downside Deviation

Better for asymmetric returns
```

## On-Chain Analytics

### 1. Whale Watching

**Large Holder Tracking:**
```
Monitor wallets with > $1M
Track their movements
Identify accumulation/distribution

Tools:
- Nansen
- Arkham Intelligence
- Etherscan
```

**Whale Metrics:**
```
Top 10 Holders: % of supply
Whale Transactions: Large moves
Exchange Flows: Deposits/withdrawals
```

### 2. Network Activity

**Transaction Count:**
```
Daily transactions on protocol
Indicates usage and adoption

Example:
Uniswap: 200K txs/day
Aave: 50K txs/day
```

**Gas Usage:**
```
Total gas spent on protocol
Indicates economic activity

Example:
Uniswap: 1000 ETH/day in gas
= $2M/day at $2000/ETH
```

### 3. Smart Money Tracking

**Definition:** Following successful traders/investors.

**Metrics:**
```
- Win rate
- Average return
- Position sizing
- Entry/exit timing
```

**Tools:**
```
- Nansen Smart Money
- DeBank Top Traders
- Arkham Intelligence
```

## Analytics Tools

### 1. DeFi Llama

**Features:**
```
- TVL tracking
- Protocol comparisons
- Chain analytics
- Yield tracking
- Stablecoin data
```

**API Access:**
```javascript
// Get protocol TVL
const tvl = await fetch('https://api.llama.fi/protocol/uniswap');

// Get chain TVL
const chainTvl = await fetch('https://api.llama.fi/chains');

// Get yields
const yields = await fetch('https://yields.llama.fi/pools');
```

### 2. Dune Analytics

**Features:**
```
- Custom SQL queries
- On-chain data analysis
- Visualization dashboards
- Community queries
```

**Example Query:**
```sql
SELECT
    DATE_TRUNC('day', block_time) as date,
    SUM(amount_usd) as volume
FROM dex.trades
WHERE project = 'Uniswap'
    AND block_time > NOW() - INTERVAL '30 days'
GROUP BY 1
ORDER BY 1;
```

### 3. Token Terminal

**Features:**
```
- Financial metrics
- Revenue tracking
- P/F ratios
- Comparative analysis
```

**Metrics Provided:**
```
- Revenue
- Fees
- Active users
- TVL
- Token price
- Market cap
```

### 4. Nansen

**Features:**
```
- Wallet labeling
- Smart money tracking
- Token god mode
- DEX analytics
- NFT analytics
```

**Smart Money Signals:**
```
- Accumulation by smart money
- Distribution by smart money
- New positions
- Closed positions
```

### 5. Messari

**Features:**
```
- Research reports
- Protocol profiles
- Metrics dashboards
- Governance tracking
```

**Standardized Metrics:**
```
- Real yield
- P/F ratio
- P/S ratio
- Active addresses
- Transaction count
```

## Advanced Analytics

### 1. Cohort Analysis

**User Retention:**
```
Month 0: 1000 new users (100%)
Month 1: 300 active (30% retention)
Month 2: 150 active (15% retention)
Month 3: 100 active (10% retention)

Long-term retention: 10%
```

**Revenue Cohorts:**
```
Track revenue generated by user cohort over time
Identify most valuable user segments
```

### 2. Funnel Analysis

**Conversion Tracking:**
```
1. Visit website: 10,000 users
2. Connect wallet: 3,000 (30%)
3. Approve token: 1,500 (15%)
4. Complete transaction: 1,000 (10%)

Conversion rate: 10%
Identify drop-off points
```

### 3. Network Effects

**Metcalfe's Law:**
```
Network Value ∝ Users²

Example:
100 users: Value = 10,000
200 users: Value = 40,000 (4x)
1000 users: Value = 1,000,000 (100x)

Network effects drive exponential growth
```

### 4. Correlation Analysis

**Asset Correlations:**
```
Correlation between protocol tokens and ETH

High correlation (> 0.8):
- Moves with market
- Beta play

Low correlation (< 0.5):
- Independent movement
- Diversification benefit
```

**Protocol Correlations:**
```
TVL correlation between protocols
Indicates shared user base
Contagion risk
```

## Predictive Metrics

### 1. NVT Ratio (Network Value to Transactions)

**Formula:**
```
NVT = Market Cap / Daily Transaction Volume

Similar to P/E ratio

High NVT: Overvalued
Low NVT: Undervalued

Example:
Market Cap: $1B
Daily Volume: $10M
NVT: 100

Compare to historical average
```

### 2. MVRV Ratio (Market Value to Realized Value)

**Formula:**
```
MVRV = Market Cap / Realized Cap

Realized Cap = Sum of (Coins × Price when last moved)

> 3.0: Overvalued (sell signal)
< 1.0: Undervalued (buy signal)
```

### 3. Funding Rates

**Perpetual Futures Funding:**
```
Positive funding: Longs pay shorts (bullish sentiment)
Negative funding: Shorts pay longs (bearish sentiment)

Extreme positive (> 0.1%/8h): Overleveraged longs
Extreme negative (< -0.1%/8h): Overleveraged shorts
```

### 4. Options Metrics

**Put/Call Ratio:**
```
Ratio = Put Volume / Call Volume

> 1.0: Bearish sentiment
< 1.0: Bullish sentiment

Extreme readings indicate reversals
```

**Implied Volatility:**
```
High IV: Expect large price moves
Low IV: Expect stability

Compare to realized volatility
```

## Dashboard Creation

### Example: Protocol Health Dashboard

**Key Metrics:**
```
1. TVL (trend)
2. Daily Active Users (trend)
3. Revenue (trend)
4. Token Price (chart)
5. Utilization Rate
6. Bad Debt
7. Liquidation Volume
8. Gas Usage
9. Whale Activity
10. Social Sentiment
```

**Alerts:**
```
- TVL drops > 10%
- Bad debt increases
- Utilization > 95%
- Large whale movements
- Governance proposals
```

**Code Example:**
```javascript
class ProtocolDashboard {
    async getTVL() {
        const response = await fetch('https://api.llama.fi/protocol/aave');
        return response.json();
    }
    
    async getUsers() {
        const query = `
            SELECT COUNT(DISTINCT "from") as users
            FROM ethereum.transactions
            WHERE "to" = '0xAaveAddress'
            AND block_time > NOW() - INTERVAL '1 day'
        `;
        return await duneQuery(query);
    }
    
    async getRevenue() {
        const fees = await this.getProtocolFees();
        const incentives = await this.getTokenIncentives();
        return fees - incentives;
    }
    
    async checkHealth() {
        const tvl = await this.getTVL();
        const users = await this.getUsers();
        const revenue = await this.getRevenue();
        
        return {
            tvl: tvl.tvl,
            users: users.users,
            revenue: revenue,
            health: this.calculateHealthScore(tvl, users, revenue)
        };
    }
}
```

## Conclusion

DeFi metrics and analytics are essential for making informed decisions, assessing protocol health, and identifying opportunities and risks. Understanding these metrics helps you evaluate protocols, compare alternatives, and track your portfolio performance. As DeFi matures, analytics will become even more sophisticated, incorporating machine learning, predictive models, and real-time risk assessment. The key is to use multiple metrics together, understand their limitations, and always verify data from multiple sources.

---

*End of DeFi Documentation Series*
